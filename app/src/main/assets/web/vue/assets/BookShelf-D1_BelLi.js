import{a0 as $,m as _,o as h,d as f,g as t,F as U,M as W,t as m,c as q,w as M,f as V,J as L,u as J,a1 as D,a2 as G,e as E,I as X,p as N,v as T,a3 as j,L as ee,a4 as te,Q as se,j as S,y as oe,D as ae,a5 as ne}from"./vendor-Bo0wn8_e.js";import{d as re,i as ie,u as ce}from"./loading-RAa6Kw1J.js";import{_ as x,A as u,u as le}from"./index-Cqf6Acgt.js";const de={class:"books-wrapper"},ue={class:"wrapper"},he=["onClick"],ge={class:"cover-img"},pe=["src"],fe={class:"info"},me={class:"name"},ve={class:"sub"},we={class:"author"},Be={key:0,class:"tags"},Ce={key:1,class:"update-info"},ke={class:"size"},ye={class:"date"},Se={key:0,class:"intro"},_e={key:1,class:"dur-chapter"},Ae={class:"last-chapter"},Re={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(e,{emit:r}){$(a=>({"6068553a":J(k)}));const i=e,v=r,C=a=>v("bookClick",a),w=a=>ie(a)?u.getProxyCoverUrl(a):a,A=a=>{a.target.src=u.getProxyCoverUrl(a.target.src)},k=_(()=>i.isSearch?"space-between":"flex-start");return(a,g)=>{const p=D;return h(),f("div",de,[t("div",ue,[(h(!0),f(U,null,W(e.books,n=>{var R;return h(),f("div",{class:"book",key:n.bookUrl,onClick:I=>C(n)},[t("div",ge,[(h(),f("img",{class:"cover",src:w(n.coverUrl),key:n.coverUrl,onErrorOnce:A,alt:"",loading:"lazy"},null,40,pe))]),t("div",fe,[t("div",me,m(n.name),1),t("div",ve,[t("div",we,m(n.author),1),e.isSearch?(h(),f("div",Be,[(h(!0),f(U,null,W((R=n.kind)==null?void 0:R.split(",").slice(0,2),I=>(h(),q(p,{key:I},{default:M(()=>[V(m(I),1)]),_:2},1024))),128))])):L("",!0),e.isSearch?L("",!0):(h(),f("div",Ce,[g[0]||(g[0]=t("div",{class:"dot"},"•",-1)),t("div",ke,"共"+m(n.totalChapterNum)+"章",1),g[1]||(g[1]=t("div",{class:"dot"},"•",-1)),t("div",ye,m(J(re)(n.lastCheckTime)),1)]))]),e.isSearch?(h(),f("div",Se,m(n.intro),1)):L("",!0),e.isSearch?L("",!0):(h(),f("div",_e," 已读："+m(n.durChapterTitle),1)),t("div",Ae,"最新："+m(n.latestChapterTitle),1)])],8,he)}),128))])])}}},Ie=x(Re,[["__scopeId","data-v-136fc284"]]),Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",Ee=G({beforeRouteEnter:(e,r,i)=>{u.getReadConfig().then(v=>v.data).then(({isSuccess:v,data:C})=>{v&&i(w=>{w.saveReadConfig(C)})}).catch(()=>i())},setup:()=>{const e=le(),r=_(()=>e.isNight),i=T({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0,isSeachBook:!1}),v=T(null),{showLoading:C,closeLoading:w,loadingWrapper:A,isLoading:k}=ce(v,"正在获取书籍信息"),a=j([]),g=_(()=>e.shelf),p=T(""),n=T(!1);ee(()=>{if(!(n.value&&p.value!="")){if(n.value=!1,a.value=[],p.value==""){a.value=g.value;return}a.value=g.value.filter(s=>s.name.includes(p.value)||s.author.includes(p.value))}});const R=()=>{p.value!=""&&(a.value=[],e.clearSearchBooks(),C(),n.value=!0,u.search(p.value,s=>{k&&w();try{e.setSearchBooks(JSON.parse(s)),a.value=e.searchBooks}catch(o){throw S.error("后端数据错误"),o}},()=>{w(),a.value.length==0&&S.info("搜索结果为空")}))},I=_(()=>e.connectStatus),H=_(()=>e.connectType),O=_(()=>e.newConnect),Z=()=>{ne.prompt("请输入 后端地址 ( 如：http://127.0.0.1:9527 或者通过内网穿透的地址)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:u.legado_http_origin,inputValidator:s=>{try{const{origin:o,protocol:c,username:l,password:d,pathname:B,search:y,hash:Q}=new URL(s);if(o==u.legado_http_origin)return"请输入非当前远程链接";if(!c.startsWith("http"))return`不支持协议${c}`;if(B!=="/"||y!==""||Q!==""||d!==""||l!=="")return`目前仅支持输入${o}`}catch{return"URL解析失败，请重新输入"}return!0},beforeClose:(s,o,c)=>{if(s==="confirm"){e.setNewConnect(!0),o.confirmButtonLoading=!0,o.confirmButtonText="校验中……";const l=o.inputValue;u.testLeagdoHttpUrlConnection(l).then(function(d){P(d),o.confirmButtonLoading=!1,e.setConnectType("success"),e.setConnectStatus("已连接 "+l),e.clearSearchBooks(),e.setNewConnect(!1),u.setLeagdoHttpUrl(l),b(),c()}).catch(function(d){throw o.confirmButtonLoading=!1,o.confirmButtonText="确定",S.error("访问失败，请检查您输入的 url"),e.setNewConnect(!1),d})}else c()}})},F=te(),K=async s=>{const{bookUrl:o,name:c,author:l,durChapterIndex:d=0,durChapterPos:B=0}=s,y="respondTime"in s;y&&await u.saveBook(s),z(o,c,l,d,B,y)},z=(s,o,c,l,d,B,y=!1)=>{if(o!=="尚无阅读记录"){if(B===!0&&y){p.value=o,R();return}sessionStorage.setItem("bookUrl",s),sessionStorage.setItem("bookName",o),sessionStorage.setItem("bookAuthor",c),sessionStorage.setItem("chapterIndex",l),sessionStorage.setItem("chapterPos",d),sessionStorage.setItem("isSeachBook",String(B)),i.value={name:o,author:c,url:s,chapterIndex:l,chapterPos:d,isSeachBook:B},localStorage.setItem("readingRecent",JSON.stringify(i.value)),F.push({path:"/chapter"})}},Y=()=>{A(e.saveBookProgress().finally(b))},P=s=>{try{e.setConfig(JSON.parse(s))}catch{S.info("阅读界面配置解析错误")}},b=()=>u.getBookShelf().then(s=>{e.setConnectType("success"),s.data.isSuccess?e.addBooks(s.data.data.sort(function(o,c){var l=o.durChapterTime||0,d=c.durChapterTime||0;return d-l})):S.error(s.data.errorMsg??"后端返回格式错误！"),e.setConnectStatus("已连接 "+u.legado_http_origin),e.setNewConnect(!1)});return se(()=>{let s=localStorage.getItem("readingRecent");s!=null&&(i.value=JSON.parse(s),typeof i.value.chapterIndex>"u"&&(i.value.chapterIndex=0)),u.testLeagdoHttpUrlConnection().then(Y).catch(function(o){throw e.setConnectType("danger"),e.setConnectStatus("连接异常"),S.error("后端连接失败异常，请检查阅读WEB服务或者设置其它可用链接"),e.setNewConnect(!1),o})}),{setLegadoRetmoteUrl:Z,isNight:r,connectStatus:I,connectType:H,newConnect:O,saveReadConfig:P,readingRecent:i,searchBook:R,books:a,handleBookClick:K,toDetail:z,isSearching:n,SearchIcon:oe,githubUrl:Le,searchWord:p}}}),Te={class:"navigation-wrapper"},Ne={class:"search-wrapper"},Me={class:"bottom-wrapper"},Ve={class:"recent-wrapper"},ze={class:"reading-recent"},Pe={class:"setting-wrapper"},be={class:"setting-item"},Ue={class:"bottom-icons"},We={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},Je={class:"bottom-icon"},De=["src"],xe={class:"shelf-wrapper",ref:"shelfWrapper"};function He(e,r,i,v,C,w){const A=ae,k=D,a=Ie;return h(),f("div",{class:N({"index-wrapper":!0,night:e.isNight,day:!e.isNight})},[t("div",Te,[r[4]||(r[4]=t("div",{class:"navigation-title-wrapper"},[t("div",{class:"navigation-title"},"阅读"),t("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),t("div",Ne,[E(A,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:e.searchWord,"onUpdate:modelValue":r[0]||(r[0]=g=>e.searchWord=g),class:"search-input","prefix-icon":e.SearchIcon,onKeyup:X(e.searchBook,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"])]),t("div",Me,[t("div",Ve,[r[2]||(r[2]=t("div",{class:"recent-title"},"最近阅读",-1)),t("div",ze,[E(k,{type:e.readingRecent.name=="尚无阅读记录"?"warning":"primary",class:N(["recent-book",{"no-point":e.readingRecent.url==""}]),size:"large",onClick:r[1]||(r[1]=g=>e.toDetail(e.readingRecent.url,e.readingRecent.name,e.readingRecent.author,e.readingRecent.chapterIndex,e.readingRecent.chapterPos,e.readingRecent.isSeachBook,!0))},{default:M(()=>[V(m(e.readingRecent.name),1)]),_:1},8,["type","class"])])]),t("div",Pe,[r[3]||(r[3]=t("div",{class:"setting-title"},"基本设定",-1)),t("div",be,[E(k,{type:e.connectType,size:"large",class:N(["setting-connect",{"no-point":e.newConnect}]),onClick:e.setLegadoRetmoteUrl},{default:M(()=>[V(m(e.connectStatus),1)]),_:1},8,["type","class","onClick"])])])]),t("div",Ue,[t("a",We,[t("div",Je,[t("img",{src:e.githubUrl,alt:""},null,8,De)])])])]),t("div",xe,[E(a,{books:e.books,onBookClick:e.handleBookClick,isSearch:e.isSearching},null,8,["books","onBookClick","isSearch"])],512)],2)}const Ke=x(Ee,[["render",He],["__scopeId","data-v-9c784ae7"]]);export{Ke as default};
