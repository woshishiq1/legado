import{a2 as se,q as T,o as r,d as h,g as e,F as W,P as O,t as l,c as ae,w as R,f as b,M as S,u as t,a3 as F,p as K,i as U,s as oe,j as C,a4 as ne,O as ce,a5 as ie,a6 as re,T as le,m as x,e as w,A as de,L as Z,x as H,I as ue,B as he}from"./vendor-B4RITwN5.js";import{d as pe,u as ve}from"./loading-BSPlXMjv.js";import{_ as Y,b as P,u as ge,A as M,s as _e}from"./index-DiJORxAd.js";const Q=n=>(K("data-v-52a7a450"),n=n(),U(),n),me={class:"books-wrapper"},fe={class:"wrapper"},we=["onClick"],Ie={class:"cover-img"},Ae=["src"],ke={class:"info"},Be={class:"name"},ye={class:"sub"},Se={class:"author"},Ce={key:0,class:"tags"},xe={key:1,class:"update-info"},Re=Q(()=>e("div",{class:"dot"},"•",-1)),be={class:"size"},Ee=Q(()=>e("div",{class:"dot"},"•",-1)),Ve={class:"date"},ze={key:0,class:"intro"},Me={key:1,class:"dur-chapter"},Te={class:"last-chapter"},Pe={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(n,{emit:a}){se(d=>({b777fdf2:t(z)}));const E=n,V=a,N=d=>V("bookClick",d),k=d=>/^data:/.test(d)?d:P()+"/cover?path="+encodeURIComponent(d),z=T(()=>E.isSearch?"space-between":"flex-start");return(d,c)=>{const B=F;return r(),h("div",me,[e("div",fe,[(r(!0),h(W,null,O(n.books,i=>{var I;return r(),h("div",{class:"book",key:i.bookUrl,onClick:A=>N(i)},[e("div",Ie,[(r(),h("img",{class:"cover",src:k(i.coverUrl),key:i.coverUrl,alt:"",loading:"lazy"},null,8,Ae))]),e("div",ke,[e("div",Be,l(i.name),1),e("div",ye,[e("div",Se,l(i.author),1),n.isSearch?(r(),h("div",Ce,[(r(!0),h(W,null,O((I=i.kind)==null?void 0:I.split(",").slice(0,2),A=>(r(),ae(B,{key:A},{default:R(()=>[b(l(A),1)]),_:2},1024))),128))])):S("",!0),n.isSearch?S("",!0):(r(),h("div",xe,[Re,e("div",be,"共"+l(i.totalChapterNum)+"章",1),Ee,e("div",Ve,l(t(pe)(i.lastCheckTime)),1)]))]),n.isSearch?(r(),h("div",ze,l(i.intro),1)):S("",!0),n.isSearch?S("",!0):(r(),h("div",Me," 已读："+l(i.durChapterTitle),1)),e("div",Te,"最新："+l(i.latestChapterTitle),1)])],8,we)}),128))])])}}},Le=Y(Pe,[["__scopeId","data-v-52a7a450"]]),Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",L=n=>(K("data-v-c22a3c0d"),n=n(),U(),n),Je={class:"navigation-wrapper"},De=L(()=>e("div",{class:"navigation-title-wrapper"},[e("div",{class:"navigation-title"},"阅读"),e("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),We={class:"search-wrapper"},Oe={class:"bottom-wrapper"},Ze={class:"recent-wrapper"},He=L(()=>e("div",{class:"recent-title"},"最近阅读",-1)),Fe={class:"reading-recent"},Ke={class:"setting-wrapper"},Ue=L(()=>e("div",{class:"setting-title"},"基本设定",-1)),Ye={class:"setting-ip"},Qe={class:"setting-item"},qe={class:"bottom-icons"},$e={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},Ge={class:"bottom-icon"},Xe=["src"],je={__name:"BookShelf",setup(n){const a=ge(),{connectStatus:E,connectType:V,newConnect:N,shelf:k}=oe(a),z=T(()=>a.config.theme),d=T(()=>z.value==6),c=C({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),B=C(null),{showLoading:i,closeLoading:I,loadingWrapper:A,isLoading:q}=ve(B,"正在获取书籍信息"),m=ne([]),p=C(""),y=C(!1);ce(()=>{if(!(y.value&&p.value!="")){if(y.value=!1,m.value=[],p.value==""){m.value=k.value;return}m.value=k.value.filter(s=>s.name.includes(p.value)||s.author.includes(p.value))}});const $=()=>{p.value!=""&&(m.value=[],a.clearSearchBooks(),i(),y.value=!0,M.search(p.value,s=>{q&&I();try{a.setSearchBooks(JSON.parse(s)),m.value=a.searchBooks}catch(o){throw x.error("后端数据错误"),o}},()=>{I(),m.value.length==0&&x.info("搜索结果为空")}))},v=ie({ip:P(),disable:!0}),G=()=>{v.ip=P(),v.disable=!v.disable},X=()=>{_e(v.ip),v.disable=!0,D()},j=re(),ee=async s=>{const{bookUrl:o,name:g,author:u,durChapterIndex:_=0,durChapterPos:f=0}=s;await M.saveBook(s),J(o,g,u,_,f)},J=(s,o,g,u,_)=>{o!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",s),sessionStorage.setItem("bookName",o),sessionStorage.setItem("bookAuthor",g),sessionStorage.setItem("chapterIndex",u),sessionStorage.setItem("chapterPos",_),c.value={name:o,author:g,url:s,chapterIndex:u,chapterPos:_},localStorage.setItem("readingRecent",JSON.stringify(c.value)),j.push({path:"/chapter"}))};le(()=>{let s=localStorage.getItem("readingRecent");s!=null&&(c.value=JSON.parse(s),typeof c.value.chapterIndex>"u"&&(c.value.chapterIndex=0)),D()});const D=()=>{a.resetConnect(),A(a.saveBookProgress().finally(te))},te=()=>M.getBookShelf().then(s=>{a.setConnectType("success"),s.data.isSuccess?a.addBooks(s.data.data.sort(function(o,g){var u=o.durChapterTime||0,_=g.durChapterTime||0;return _-u})):x.error(s.data.errorMsg),a.setConnectStatus("已连接 "),a.setNewConnect(!1)}).catch(function(s){throw a.setConnectType("danger"),a.setConnectStatus("连接失败"),x.error("后端连接失败"),a.setNewConnect(!1),s});return(s,o)=>{const g=ue,u=F,_=Le;return r(),h("div",{class:H({"index-wrapper":!0,night:t(d),day:!t(d)})},[e("div",Je,[De,e("div",We,[w(g,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:t(p),"onUpdate:modelValue":o[0]||(o[0]=f=>de(p)?p.value=f:null),class:"search-input","prefix-icon":t(he),onKeyup:Z($,["enter"])},null,8,["modelValue","prefix-icon"])]),e("div",Oe,[e("div",Ze,[He,e("div",Fe,[w(u,{type:t(c).name=="尚无阅读记录"?"warning":"",class:H(["recent-book",{"no-point":t(c).url==""}]),size:"large",onClick:o[1]||(o[1]=f=>J(t(c).url,t(c).name,t(c).author,t(c).chapterIndex,t(c).chapterPos))},{default:R(()=>[b(l(t(c).name),1)]),_:1},8,["type","class"])])]),e("div",Ke,[Ue,e("div",Ye,[w(g,{class:"setting-input",size:"small",disabled:t(v).disable,modelValue:t(v).ip,"onUpdate:modelValue":o[2]||(o[2]=f=>t(v).ip=f),onKeydown:Z(X,["enter"])},null,8,["disabled","modelValue"]),w(u,{type:"primary",class:"setting-toggle",onClick:G},{default:R(()=>[b(l(t(v).disable?"修改":"取消"),1)]),_:1})]),e("div",Qe,[w(u,{type:t(V),size:"large",class:"setting-connect"},{default:R(()=>[b(l(t(E)),1)]),_:1},8,["type"])])])]),e("div",qe,[e("a",$e,[e("div",Ge,[e("img",{src:t(Ne),alt:""},null,8,Xe)])])])]),e("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:B},[w(_,{books:t(m),onBookClick:ee,isSearch:t(y)},null,8,["books","isSearch"])],512)],2)}}},at=Y(je,[["__scopeId","data-v-c22a3c0d"]]);export{at as default};
